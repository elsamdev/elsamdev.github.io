<html>

<head>
  <base href="https://websim.ai/" />
</head>

<body>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
    }

    #game-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    #game-map {
      border: 1px solid #000;
      background-color: #fff;
      cursor: pointer;
    }

    #game-info {
      margin-top: 20px;
      display: flex;
      justify-content: space-around;
      width: 100%;
      flex-wrap: wrap;
    }

    .tribe-info {
      background-color: #fff;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 5px;
      font-size: 12px;
      margin-bottom: 10px;
      width: calc(20% - 20px);
    }

    #resource-info {
      margin-top: 20px;
      background-color: #fff;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 5px;
      font-size: 12px;
    }

    #speed-controls {
      margin-top: 10px;
    }

    .speed-btn {
      margin: 0 5px;
      padding: 5px 10px;
      font-size: 14px;
      cursor: pointer;
    }

    .active {
      background-color: #4CAF50;
      color: white;
    }

    #member-stats {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: white;
      border: 1px solid #ccc;
      padding: 20px;
      border-radius: 5px;
      z-index: 1000;
      display: none;
    }

    #member-stats h3 {
      margin-top: 0;
    }

    #close-stats {
      position: absolute;
      top: 5px;
      right: 5px;
      cursor: pointer;
    }
  </style>

  <div id="game-container">
    <canvas id="game-map" width="400" height="300"></canvas>
    <div id="speed-controls">
      <button class="speed-btn active" data-speed="1">x1</button>
      <button class="speed-btn" data-speed="2">x2</button>
      <button class="speed-btn" data-speed="3">x3</button>
      <button class="speed-btn" data-speed="4">x4</button>
      <button class="speed-btn" data-speed="5">x5</button>
    </div>
    <div id="game-info"></div>
    <div id="resource-info"></div>
  </div>

  <div id="member-stats">
    <span id="close-stats">&times;</span>
    <h3>Member Stats</h3>
    <div id="stats-content"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/simplex-noise/2.4.0/simplex-noise.min.js"></script>
  <script>
    const canvas = document.getElementById('game-map');
    const ctx = canvas.getContext('2d');
    const gameInfo = document.getElementById('game-info');
    const resourceInfo = document.getElementById('resource-info');
    const speedControls = document.getElementById('speed-controls');
    const memberStats = document.getElementById('member-stats');
    const statsContent = document.getElementById('stats-content');
    const closeStats = document.getElementById('close-stats');

    const mapWidth = 400;
    const mapHeight = 300;
    const numTribes = 5;
    const numResources = 10;

    let gameSpeed = 1;
    let animationFrameId;

    const terrainTypes = {
      WATER: { color: '#4287f5', passable: true },
      PLAINS: { color: '#90EE90', passable: true },
      FOREST: { color: '#228B22', passable: true },
      MOUNTAIN: { color: '#A9A9A9', passable: true }
    };

    const resources = [
      { name: 'Gold', color: '#FFD700' },
      { name: 'Iron', color: '#A19D94' },
      { name: 'Wood', color: '#8B4513' },
      { name: 'Stone', color: '#808080' },
      { name: 'Food', color: '#FF6347' }
    ];

    let gameMap = [];
    let tribes = [];
    let gameResources = [];

    function generateMap() {
      const noise = new SimplexNoise();
      const scale = 0.1;

      for (let y = 0; y < mapHeight; y++) {
        gameMap[y] = [];
        for (let x = 0; x < mapWidth; x++) {
          const value = noise.noise2D(x * scale, y * scale);
          if (value < -0.4) { // Más agua
            gameMap[y][x] = terrainTypes.WATER;
          } else if (value < 0.8) { // Más llanuras
            gameMap[y][x] = terrainTypes.PLAINS;
          } else if (value < 0.4) { // Menos bosques
            gameMap[y][x] = terrainTypes.FOREST;
          } else { // Menos montañas
            gameMap[y][x] = terrainTypes.MOUNTAIN;
          }
        }
      }
    }

    function generateTribes() {
      const tribeColors = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF'];
      const usedPositions = new Set();

      for (let i = 0; i < numTribes; i++) {
        let x, y;
        do {
          x = Math.floor(Math.random() * (mapWidth - 20)) + 10;
          y = Math.floor(Math.random() * (mapHeight - 20)) + 10;
        } while (!gameMap[y][x].passable || usedPositions.has(`${x},${y}`));

        usedPositions.add(`${x},${y}`);

        const tribe = {
          id: i,
          color: tribeColors[i],
          house: { x, y },
          members: [],
          resources: {},
          livingMembers: 10
        };

        for (let j = 0; j < 10; j++) {
          let memberX, memberY;
          do {
            memberX = x + Math.floor(Math.random() * 21) - 10;
            memberY = y + Math.floor(Math.random() * 21) - 10;
          } while (
            memberX < 0 || memberX >= mapWidth ||
            memberY < 0 || memberY >= mapHeight ||
            !gameMap[memberY][memberX].passable
          );

          tribe.members.push({
            id: j,
            x: memberX,
            y: memberY,
            atk: Math.floor(Math.random() * 10) + 1,
            def: Math.floor(Math.random() * 10) + 1,
            hp: Math.floor(Math.random() * 50) + 50,
            as: Math.floor(Math.random() * 5) + 1
          });
        }

        resources.forEach(resource => {
          tribe.resources[resource.name] = 0;
        });

        tribes.push(tribe);
      }
    }

    function generateResources() {
      for (let i = 0; i < numResources; i++) {
        let x, y;
        do {
          x = Math.floor(Math.random() * mapWidth);
          y = Math.floor(Math.random() * mapHeight);
        } while (!gameMap[y][x].passable);

        const resource = {
          ...resources[Math.floor(Math.random() * resources.length)],
          x,
          y
        };
        gameResources.push(resource);
      }
    }

    function drawMap() {
      for (let y = 0; y < mapHeight; y++) {
        for (let x = 0; x < mapWidth; x++) {
          ctx.fillStyle = gameMap[y][x].color;
          ctx.fillRect(x, y, 1, 1);
        }
      }
    }

    function drawTribes() {
      tribes.forEach(tribe => {
        ctx.fillStyle = tribe.color;
        ctx.fillRect(tribe.house.x - 2, tribe.house.y - 2, 5, 5);
        tribe.members.forEach(member => {
          ctx.fillStyle = tribe.color;
          ctx.fillRect(member.x, member.y, 1, 1);
        });
      });
    }

    function drawResources() {
      gameResources.forEach(resource => {
        ctx.fillStyle = resource.color;
        ctx.fillRect(resource.x - 1, resource.y - 1, 3, 3);
      });
    }

    function updateGameInfo() {
      gameInfo.innerHTML = '';
      tribes.forEach(tribe => {
        const tribeInfoDiv = document.createElement('div');
        tribeInfoDiv.className = 'tribe-info';
        tribeInfoDiv.style.borderColor = tribe.color;
        tribeInfoDiv.innerHTML = `
      <h3>Tribe ${tribe.id + 1}</h3>
      <p>Living Members: ${tribe.livingMembers}</p>
      <p>Resources:</p>
      <ul>
        ${Object.entries(tribe.resources).map(([name, count]) => `<li>${name}: ${count}</li>`).join('')}
      </ul>
      <h4>Members:</h4>
      <ul>
        ${tribe.members.map(member => `
          <li>
            <a href="#" class="member-link" data-tribe="${tribe.id}" data-member="${member.id}">
              Member ${member.id + 1}: HP ${member.hp}
            </a>
          </li>
        `).join('')}
      </ul>
    `;
        gameInfo.appendChild(tribeInfoDiv);
      });

      resourceInfo.innerHTML = `
    <h3>Remaining Resources</h3>
    <ul>
      ${gameResources.map(resource => `<li>${resource.name} at (${resource.x}, ${resource.y})</li>`).join('')}
    </ul>
  `;

      // Add event listeners to member links
      document.querySelectorAll('.member-link').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const tribeId = parseInt(e.target.dataset.tribe);
          const memberId = parseInt(e.target.dataset.member);
          showMemberStats(tribeId, memberId);
        });
      });
    }

    function showMemberStats(tribeId, memberId) {
      const tribe = tribes[tribeId];
      const member = tribe.members.find(m => m.id === memberId);

      if (member) {
        statsContent.innerHTML = `
      <p>Tribe: ${tribeId + 1}</p>
      <p>Member ID: ${memberId + 1}</p>
      <p>HP: ${member.hp}</p>
      <p>Attack: ${member.atk}</p>
      <p>Defense: ${member.def}</p>
      <p>Attack Speed: ${member.as}</p>
      <p>Position: (${member.x}, ${member.y})</p>
    `;
        memberStats.style.display = 'block';
      }
    }

    function moveTribeMembers() {
      tribes.forEach(tribe => {
        tribe.members.forEach(member => {
          const dx = Math.floor(Math.random() * 3) - 1;
          const dy = Math.floor(Math.random() * 3) - 1;
          const newX = Math.max(0, Math.min(mapWidth - 1, member.x + dx));
          const newY = Math.max(0, Math.min(mapHeight - 1, member.y + dy));

          if (gameMap[newY][newX].passable) {
            member.x = newX;
            member.y = newY;
          }
        });
      });
    }

    function collectResources() {
      tribes.forEach(tribe => {
        tribe.members.forEach(member => {
          gameResources.forEach((resource, index) => {
            if (Math.abs(member.x - resource.x) <= 1 && Math.abs(member.y - resource.y) <= 1) {
              tribe.resources[resource.name]++;
              gameResources.splice(index, 1);
            }
          });
        });
      });
    }

    function combat() {
      tribes.forEach((tribe, tribeIndex) => {
        tribe.members.forEach((member, memberIndex) => {
          tribes.forEach((enemyTribe, enemyTribeIndex) => {
            if (tribeIndex !== enemyTribeIndex) {
              enemyTribe.members.forEach((enemyMember, enemyMemberIndex) => {
                if (Math.abs(member.x - enemyMember.x) <= 8 && Math.abs(member.y - enemyMember.y) <= 8) {
                  const damage = Math.max(0, member.atk - enemyMember.def);
                  enemyMember.hp -= damage;

                  if (enemyMember.hp <= 0) {
                    enemyTribe.members.splice(enemyMemberIndex, 1);
                    enemyTribe.livingMembers--;
                    member.hp = 100; // Fully recover health
                  }
                }
              });
            }
          });
        });
      });
    }

    function checkVictoryCondition() {
      tribes.forEach(tribe => {
        const hasAllResources = resources.every(resource => tribe.resources[resource.name] > 0);
        if (hasAllResources) {
          alert(`Tribe ${tribe.id + 1} has won the game!`);
          initGame();
        }
      });
    }

    function gameLoop() {
      ctx.clearRect(0, 0, mapWidth, mapHeight);
      drawMap();
      drawTribes();
      drawResources();

      for (let i = 0; i < gameSpeed; i++) {
        moveTribeMembers();
        collectResources();
        combat();
      }

      updateGameInfo();
      checkVictoryCondition();
      animationFrameId = requestAnimationFrame(gameLoop);
    }

    function initGame() {
      if (animationFrameId) {
        cancelAnimationFrame(animationFrameId);
      }
      gameMap = [];
      tribes = [];
      gameResources = [];
      generateMap();
      generateTribes();
      generateResources();
      updateGameInfo();
      gameLoop();
    }

    speedControls.addEventListener('click', (e) => {
      if (e.target.classList.contains('speed-btn')) {
        gameSpeed = parseInt(e.target.dataset.speed);
        document.querySelectorAll('.speed-btn').forEach(btn => btn.classList.remove('active'));
        e.target.classList.add('active');
      }
    });

    closeStats.addEventListener('click', () => {
      memberStats.style.display = 'none';
    });

    canvas.addEventListener('click', (e) => {
      const rect = canvas.getBoundingClientRect();
      const x = Math.floor((e.clientX - rect.left) * (canvas.width / rect.width));
      const y = Math.floor((e.clientY - rect.top) * (canvas.height / rect.height));

      tribes.forEach((tribe, tribeIndex) => {
        tribe.members.forEach((member, memberIndex) => {
          if (Math.abs(member.x - x) <= 1 && Math.abs(member.y - y) <= 1) {
            showMemberStats(tribeIndex, member.id);
          }
        });
      });
    });

    initGame();
  </script>
</body>

</html>