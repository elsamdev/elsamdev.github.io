<html>

<head>
  <base href="https://fantasy-character-sprite-generator.example.com/">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fantasy Character Sprite Generator</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background-color: #1a1a2e;
      color: #e0e0e0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    h1 {
      color: #00ff99;
      text-shadow: 2px 2px 4px rgba(0, 255, 153, 0.3);
    }

    #canvas {
      border: 2px solid #00ff99;
      background-color: #0f0f1a;
    }

    #controls {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }

    button,
    select {
      background-color: #00ff99;
      color: #1a1a2e;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
    }

    button:hover,
    select:hover {
      background-color: #00cc7a;
      transform: translateY(-2px);
    }
  </style>
</head>

<body>
  <h1>Fantasy Character Sprite Generator</h1>
  <button id="animateButton" onclick="startAnimationDef()">Defense</button>
  <button id="animateButton" onclick="startAnimationAtk()">Atk</button>
  <canvas id="canvas" width="64" height="64"></canvas>
  <div id="controls">
    <select id="raceSelect">
      <option value="human">Human</option>
      <option value="elf">Elf</option>
      <option value="dwarf">Dwarf</option>
      <option value="orc">Orc</option>
    </select>
    <select id="professionSelect">
      <option value="mage">Mage</option>
      <option value="warrior">Warrior</option>
      <option value="archer">Archer</option>
      <option value="thief">Thief</option>
    </select>
    <button onclick="generateSprite()">Generate New Character</button>
    <button onclick="downloadSprite()">Download Sprite</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/seedrandom/3.0.5/seedrandom.min.js"></script>
  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const pixelSize = 4;
    const spriteSize = 16;
    let currentSprite;
    let spriteYPosition = 0;  // Variable para la posición en Y del sprite
    let spriteXPosition = 0;  // Variable para la posición en X del sprite
    let startXPosition = 0;   // Variable para almacenar la posición inicial en X
    let targetXPosition = 0;  // Variable para la posición X objetivo
    let directionY = 1;  // Controla la dirección del movimiento en Y (1 para abajo, -1 para arriba)
    let directionX = 0;  // Controla la dirección del movimiento en X (1 para adelante, -1 para atrás)
    let currentProfession;  // Variable para almacenar la profesión actual
    let animationFrameId;  // Variable para almacenar el ID del requestAnimationFrame
    let isAnimating = false;  // Variable para controlar si la animación está en curso


    const colors = {
      skin: {
        human: ['#ffdab9', '#f0e68c', '#d2691e', '#8b4513', '#ffe4b5'],
        elf: ['#fef9f5', '#fef3ec', '#fdede2', '#fde7d9', '#fcd0b4', '#dcb69d'],
        dwarf: ['#cd853f', '#deb887', '#d2691e', '#8b4513'],
        orc: ['#9acd32', '#6b8e23', '#556b2f', '#3cb371']
      },
      hair: {
        human: ['#ffd700', '#38761d', '#93b7ea', '#c0c0c0', '#36454f', '#800000', '#4b0082'],
        elf: ['#ffffbf', '#fafbfd', '#6ed38a', '#e6e6fa', '#e5be01', '#ffd74b', '#fff400'],
        dwarf: ['#b8860b', '#cd853f', '#8b4513', '#a0522d', '#d2691e', '#800000'],
        orc: ['#32cd32', '#228b22', '#006400', '#adff2f', '#7fff00', '#00ff00']
      },
      clothing: {
        mage: ['#4169e1', '#9932cc', '#228b22', '#b22222', '#4b0082', '#800080', '#008080'],
        warrior: ['#8b0000', '#b8860b', '#bdb76b', '#a9a9a9', '#2f4f4f'],
        archer: ['#006400', '#228b22', '#8fbc8f', '#20b2aa', '#2e8b57'],
        thief: ['#2f4f4f', '#696969', '#778899', '#708090', '#4682b4']
      },
      shoes: ['#8b4513', '#36454f', '#800000', '#4b0082', '#000000'],
      weaponDetails: ['#ffd700', '#ff69b4', '#00ffff', '#ff4500', '#32cd32', '#9400d3']
    };

    function randomChoice(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function drawPixel(x, y, color) {
      ctx.fillStyle = color;
      ctx.fillRect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
      // currentSprite.push({ x, y, color: color });  // You might want to track this if needed.
    }
    function generateSprite() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      currentSprite = [];

      const race = document.getElementById('raceSelect').value;
      const profession = document.getElementById('professionSelect').value;
      currentProfession = document.getElementById('professionSelect').value;

      const skinColor = randomChoice(colors.skin[race]);
      let hairColor;
      do {
        hairColor = randomChoice(colors.hair[race]);
      } while (hairColor === skinColor || isSimilarColor(hairColor, skinColor));

      const clothingColor = randomChoice(colors.clothing[profession]);
      const shoesColor = randomChoice(colors.shoes);

      // Generate head
      for (let y = 2; y < 6; y++) {
        for (let x = 6; x < 10; x++) {
          drawPixel(x, y, skinColor);
          currentSprite.push({ x, y, color: skinColor });
        }
      }

      // Generate hair and race-specific features
      const hairStyle = Math.floor(Math.random() * 6); // Now 6 hairstyles for more variety
      switch (race) {
        case 'human':
          switch (hairStyle) {
            case 0: // Short hair
              console.log('case 0');
              for (let y = 1; y < 3; y++) {
                for (let x = 5; x < 11; x++) {
                  drawPixel(x, y, hairColor);
                  currentSprite.push({ x, y, color: hairColor });
                }
              }
              break;
            case 1: // Long hair
              console.log('case 1');
              // for (let y = 1; y < 8; y++) {
              //   for (let x = 5; x < 11; x++) {
              //     if (y < 3 || (x > 5 && x < 10)) {
              //       drawPixel(x, y, hairColor);
              //       currentSprite.push({ x, y, color: hairColor });
              //     }
              //   }
              // }
              break;
            case 2: // Bald with beard
              console.log('case 2');
              for (let y = 5; y < 7; y++) {
                for (let x = 5; x < 11; x++) {
                  drawPixel(x, y, hairColor);
                  currentSprite.push({ x, y, color: hairColor });
                }
              }
              break;
            case 3: // Mohawk
              for (let y = 0; y < 3; y++) {
                for (let x = 7; x < 9; x++) {
                  drawPixel(x, y, hairColor);
                  currentSprite.push({ x, y, color: hairColor });
                }
              }
              break;
            case 4: // Ponytail
              for (let y = 1; y < 3; y++) {
                for (let x = 6; x < 10; x++) {
                  drawPixel(x, y, hairColor);
                  currentSprite.push({ x, y, color: hairColor });
                }
              }
              for (let y = 3; y < 8; y++) {
                drawPixel(8, y, hairColor);
                currentSprite.push({ x: 8, y, color: hairColor });
              }
              break;
            case 5: // Curly hair
              for (let y = 1; y < 4; y++) {
                for (let x = 5; x < 11; x++) {
                  if (Math.random() > 0.3) {
                    drawPixel(x, y, hairColor);
                    currentSprite.push({ x, y, color: hairColor });
                  }
                }
              }
              break;
          }
          break;
        case 'elf':
          switch (hairStyle) {
            case 0: // Long, flowing hair
              console.log('case 0');
              for (let y = 0; y < 8; y++) {
                for (let x = 5; x < 10; x++) {
                  if (y < 2 || x === 6 || x === 9) {
                    drawPixel(x, y, hairColor);
                    currentSprite.push({ x, y, color: hairColor });
                  }
                }
              }
              const leafColor = '#32cd32';
              drawPixel(5, 0, leafColor);
              drawPixel(10, 0, leafColor);
              drawPixel(6, 1, leafColor);
              drawPixel(9, 1, leafColor);
              currentSprite.push({ x: 5, y: 0, color: leafColor });
              currentSprite.push({ x: 10, y: 0, color: leafColor });
              currentSprite.push({ x: 6, y: 1, color: leafColor });
              currentSprite.push({ x: 9, y: 1, color: leafColor });
              break;
            case 1: // Braided crown
              console.log('case 1');
              for (let y = 1; y < 3; y++) {
                for (let x = 5; x < 11; x++) {
                  drawPixel(x, y, hairColor);
                  currentSprite.push({ x, y, color: hairColor });
                }
              }
              for (let x = 5; x < 11; x += 2) {
                drawPixel(x, 0, hairColor);
                currentSprite.push({ x, y: 0, color: hairColor });
              }
              break;
            case 2: // Side-swept bangs
              console.log('case 2');
              for (let y = 1; y < 6; y++) {
                for (let x = 5; x < 11; x++) {
                  if (y < 3 || (x > 8 && x < 10)) {
                    drawPixel(x, y, hairColor);
                    currentSprite.push({ x, y, color: hairColor });
                  }
                }
              }

              drawPixel(9, 4, '#32cd32');
              drawPixel(9, 2, '#32cd32');
              currentSprite.push({ x: 9, y: 4, color: '#32cd32' });
              currentSprite.push({ x: 9, y: 2, color: '#32cd32' });
              drawPixel(8, 1, '#32cd32');

              currentSprite.push({ x: 8, y: 1, color: '#32cd32' });

              break;
            case 3: // High ponytail
              console.log("case 3");
              for (let y = 0; y < 8; y++) {
                for (let x = 5; x < 10; x++) {
                  if (y < 2 || x === 6 || x === 9) {
                    drawPixel(x, y, hairColor);
                    currentSprite.push({ x, y, color: hairColor });
                  }
                }
              }
              break;
            case 4: // Leafy hair ornaments
              console.log("case 4");
              for (let y = 1; y < 4; y++) {
                for (let x = 5; x < 11; x++) {
                  drawPixel(x, y, hairColor);
                  currentSprite.push({ x, y, color: hairColor });
                }
              }
              const leafColor2 = '#32cd32';
              drawPixel(5, 0, leafColor2);
              drawPixel(10, 0, leafColor2);
              drawPixel(6, 1, leafColor2);
              drawPixel(9, 1, leafColor2);
              currentSprite.push({ x: 5, y: 0, color: leafColor2 });
              currentSprite.push({ x: 10, y: 0, color: leafColor2 });
              currentSprite.push({ x: 6, y: 1, color: leafColor2 });
              currentSprite.push({ x: 9, y: 1, color: leafColor2 });
              break;
            case 5: // Shaved sides with long top
              for (let y = 1; y < 6; y++) {
                for (let x = 5; x < 11; x++) {
                  if (y < 3 || (x > 8 && x < 10)) {
                    drawPixel(x, y, hairColor);
                    currentSprite.push({ x, y, color: hairColor });
                  }
                }
              }

              break;
          }
          // Improved pointy ears
          drawPixel(4, 2, skinColor);
          drawPixel(5, 2, skinColor);
          drawPixel(4, 3, skinColor);
          drawPixel(11, 2, skinColor);
          drawPixel(10, 2, skinColor);
          drawPixel(11, 3, skinColor);
          currentSprite.push({ x: 4, y: 2, color: skinColor });
          currentSprite.push({ x: 5, y: 2, color: skinColor });
          currentSprite.push({ x: 4, y: 3, color: skinColor });
          currentSprite.push({ x: 11, y: 2, color: skinColor });
          currentSprite.push({ x: 10, y: 2, color: skinColor });
          currentSprite.push({ x: 11, y: 3, color: skinColor });

          // Add ear details
          const earDetailColor = randomChoice(['#ffffff', '#fffafa', '#f0fff0']);
          drawPixel(4, 2, earDetailColor);
          drawPixel(11, 2, earDetailColor);
          currentSprite.push({ x: 4, y: 2, color: earDetailColor });
          currentSprite.push({ x: 11, y: 2, color: earDetailColor });
          break;
        case 'dwarf':
          switch (hairStyle) {
            case 0: // Bushy beard and hair
              for (let y = 1; y < 8; y++) {
                for (let x = 4; x < 12; x++) {
                  if (y < 3 || y > 4) {
                    drawPixel(x, y, hairColor);
                    currentSprite.push({ x, y, color: hairColor });
                  }
                }
              }
              break;
            case 1: // Long braided beard
              for (let y = 4; y < 12; y++) {
                for (let x = 5; x < 11; x++) {
                  if (x === 6 || x === 9 || y < 6) {
                    drawPixel(x, y, hairColor);
                    currentSprite.push({ x, y, color: hairColor });
                  }
                }
              }
              break;
            case 2: // Mohawk with beard
              for (let y = 0; y < 3; y++) {
                for (let x = 7; x < 9; x++) {
                  drawPixel(x, y, hairColor);
                  currentSprite.push({ x, y, color: hairColor });
                }
              }
              for (let y = 4; y < 8; y++) {
                for (let x = 5; x < 11; x++) {
                  drawPixel(x, y, hairColor);
                  currentSprite.push({ x, y, color: hairColor });
                }
              }
              break;
            case 3: // Bald with elaborate beard
              for (let y = 4; y < 10; y++) {
                for (let x = 4; x < 12; x++) {
                  if (y < 6 || (x > 5 && x < 10)) {
                    drawPixel(x, y, hairColor);
                    currentSprite.push({ x, y, color: hairColor });
                  }
                }
              }
              break;
            case 4: // Twin braids and mustache
              for (let y = 1; y < 10; y++) {
                drawPixel(5, y, hairColor);
                drawPixel(10, y, hairColor);
                currentSprite.push({ x: 5, y, color: hairColor });
                currentSprite.push({ x: 10, y, color: hairColor });
              }
              for (let x = 6; x < 10; x++) {
                drawPixel(x, 5, hairColor);
                currentSprite.push({ x, y: 5, color: hairColor });
              }
              break;
            case 5: // Wild, unkempt hair and beard
              for (let y = 1; y < 9; y++) {
                for (let x = 4; x < 12; x++) {
                  if (Math.random() > 0.3) {
                    drawPixel(x, y, hairColor);
                    currentSprite.push({ x, y, color: hairColor });
                  }
                }
              }
              break;
          }
          break;
        case 'orc':
          switch (hairStyle) {
            case 0: // Mohawk
              for (let y = 0; y < 3; y++) {
                for (let x = 7; x < 9; x++) {
                  drawPixel(x, y, hairColor);
                  currentSprite.push({ x, y, color: hairColor });
                }
              }
              break;
            case 1: // Topknot
              for (let y = 0; y < 4; y++) {
                for (let x = 7; x < 9; x++) {
                  drawPixel(x, y, hairColor);
                  currentSprite.push({ x, y, color: hairColor });
                }
              }
              drawPixel(6, 1, hairColor);
              drawPixel(9, 1, hairColor);
              currentSprite.push({ x: 6, y: 1, color: hairColor });
              currentSprite.push({ x: 9, y: 1, color: hairColor });
              break;
            case 2: // Dreadlocks

              for (let y = 1; y < 8; y++) {
                for (let x = 5; x < 11; x += 2) {
                  drawPixel(x, y, hairColor);
                  currentSprite.push({ x, y, color: hairColor });
                }
              }

              break;
            case 3: // Bald with war paint
              const warPaintColor = randomChoice(['#ff0000', '#ffffff', '#ffff00']);
              drawPixel(6, 2, warPaintColor);
              drawPixel(9, 2, warPaintColor);
              drawPixel(7, 3, warPaintColor);
              drawPixel(8, 3, warPaintColor);
              currentSprite.push({ x: 6, y: 2, color: warPaintColor });
              currentSprite.push({ x: 9, y: 2, color: warPaintColor });
              currentSprite.push({ x: 7, y: 3, color: warPaintColor });
              currentSprite.push({ x: 8, y: 3, color: warPaintColor });
              break;
            case 4: // Spiked hair
              for (let y = 0; y < 3; y++) {
                for (let x = 5; x < 11; x += 2) {
                  drawPixel(x, y, hairColor);
                  currentSprite.push({ x, y, color: hairColor });
                }
              }
              break;
            case 5: // Side-shaved with long top
              for (let y = 1; y < 5; y++) {
                for (let x = 7; x < 11; x++) {
                  drawPixel(x, y, hairColor);
                  currentSprite.push({ x, y, color: hairColor });
                }
              }
              break;
          }
          // Tusks
          drawPixel(6, 5, '#ffffff');
          drawPixel(9, 5, '#ffffff');
          currentSprite.push({ x: 6, y: 5, color: '#ffffff' });
          currentSprite.push({ x: 9, y: 5, color: '#ffffff' });
          break;
      }

      // Generate body (profession-specific)
      switch (profession) {
        case 'mage':
          // Robe
          for (let y = 6; y < 14; y++) {
            for (let x = 4; x < 12; x++) {
              if (Math.random() > 0.2) {
                drawPixel(x, y, clothingColor);
                currentSprite.push({ x, y, color: clothingColor });
              }
            }
          }
          // Improved staff design with random color details
          const staffColor = '#8b4513';
          const gemColor = randomChoice(colors.weaponDetails);
          const detailColor = randomChoice(colors.weaponDetails);

          // Staff shaft
          for (let y = 4; y < 15; y++) {
            drawPixel(3, y, staffColor);
            currentSprite.push({ x: 3, y, color: staffColor });
          }

          // Staff head
          drawPixel(2, 3, staffColor);
          drawPixel(4, 3, staffColor);
          drawPixel(1, 2, detailColor);
          drawPixel(5, 2, detailColor);
          drawPixel(3, 1, detailColor);
          drawPixel(3, 2, gemColor);

          currentSprite.push({ x: 2, y: 3, color: staffColor });
          currentSprite.push({ x: 4, y: 3, color: staffColor });
          currentSprite.push({ x: 1, y: 2, color: detailColor });
          currentSprite.push({ x: 5, y: 2, color: detailColor });
          currentSprite.push({ x: 3, y: 1, color: detailColor });
          currentSprite.push({ x: 3, y: 2, color: gemColor });

          // Random decorative details on staff
          for (let y = 5; y < 14; y += 3) {
            drawPixel(2, y, detailColor);
            drawPixel(4, y, detailColor);
            currentSprite.push({ x: 2, y, color: detailColor });
            currentSprite.push({ x: 4, y, color: detailColor });
          }

          // Hands holding staff
          drawPixel(4, 9, skinColor);
          drawPixel(4, 10, skinColor);
          currentSprite.push({ x: 4, y: 9, color: skinColor });
          currentSprite.push({ x: 4, y: 10, color: skinColor });
          break;
        case 'warrior':
          // Armor
          for (let y = 6; y < 14; y++) {
            for (let x = 5; x < 11; x++) {
              drawPixel(x, y, clothingColor);
              currentSprite.push({ x, y, color: clothingColor });
            }
          }
          // Improved sword design with random color details
          const bladeColor = '#c0c0c0';
          const hiltColor = randomChoice(['#ffd700', '#c0c0c0', '#8b4513']);
          const swordDetailColor = randomChoice(colors.weaponDetails);

          // Sword blade
          for (let y = 6; y < 15; y++) {
            drawPixel(12, y, bladeColor);
            currentSprite.push({ x: 12, y, color: bladeColor });
          }

          // Sword edge highlight
          for (let y = 7; y < 14; y++) {
            drawPixel(13, y, swordDetailColor);
            currentSprite.push({ x: 13, y, color: swordDetailColor });
          }

          // Sword hilt
          drawPixel(11, 6, hiltColor);
          drawPixel(13, 6, hiltColor);
          drawPixel(12, 5, hiltColor);
          drawPixel(12, 4, swordDetailColor);
          currentSprite.push({ x: 11, y: 6, color: hiltColor });
          currentSprite.push({ x: 13, y: 6, color: hiltColor });
          currentSprite.push({ x: 12, y: 5, color: hiltColor });
          currentSprite.push({ x: 12, y: 4, color: swordDetailColor });

          // Hands holding sword
          drawPixel(11, 9, skinColor);
          drawPixel(11, 10, skinColor);
          currentSprite.push({ x: 11, y: 9, color: skinColor });
          currentSprite.push({ x: 11, y: 10, color: skinColor });
          break;
        case 'archer':
          // Light armor
          for (let y = 6; y < 14; y++) {
            for (let x = 5; x < 11; x++) {
              if (Math.random() > 0.3) {
                drawPixel(x, y, clothingColor);
                currentSprite.push({ x, y, color: clothingColor });
              }
            }
          }
          // Improved bow design with random color details
          const bowColor = '#8b4513';
          const stringColor = '#ffffff';
          const bowDetailColor = randomChoice(colors.weaponDetails);

          // Bow curve (larger and more visible)
          drawPixel(11, 4, bowColor);
          drawPixel(12, 5, bowColor);
          drawPixel(13, 6, bowColor);
          drawPixel(14, 7, bowColor);
          drawPixel(14, 8, bowColor);
          drawPixel(14, 9, bowColor);
          drawPixel(14, 10, bowColor);
          drawPixel(13, 11, bowColor);
          drawPixel(12, 12, bowColor);
          drawPixel(11, 13, bowColor);

          // Bow details
          drawPixel(12, 4, bowDetailColor);
          drawPixel(13, 5, bowDetailColor);
          drawPixel(15, 8, bowDetailColor);
          drawPixel(15, 9, bowDetailColor);
          drawPixel(13, 12, bowDetailColor);
          drawPixel(12, 13, bowDetailColor);

          // Straight bowstring
          for (let y = 4; y <= 13; y++) {
            drawPixel(10, y, stringColor);
            currentSprite.push({ x: 10, y, color: stringColor });
          }

          // Add bow pixels to currentSprite
          currentSprite.push({ x: 11, y: 4, color: bowColor });
          currentSprite.push({ x: 12, y: 5, color: bowColor });
          currentSprite.push({ x: 13, y: 6, color: bowColor });
          currentSprite.push({ x: 14, y: 7, color: bowColor });
          currentSprite.push({ x: 14, y: 8, color: bowColor });
          currentSprite.push({ x: 14, y: 9, color: bowColor });
          currentSprite.push({ x: 14, y: 10, color: bowColor });
          currentSprite.push({ x: 13, y: 11, color: bowColor });
          currentSprite.push({ x: 12, y: 12, color: bowColor });
          currentSprite.push({ x: 11, y: 13, color: bowColor });

          // Add bow detail pixels to currentSprite
          currentSprite.push({ x: 12, y: 4, color: bowDetailColor });
          currentSprite.push({ x: 13, y: 5, color: bowDetailColor });
          currentSprite.push({ x: 15, y: 8, color: bowDetailColor });
          currentSprite.push({ x: 15, y: 9, color: bowDetailColor });
          currentSprite.push({ x: 13, y: 12, color: bowDetailColor });
          currentSprite.push({ x: 12, y: 13, color: bowDetailColor });

          // Hands holding bow
          drawPixel(11, 8, skinColor);
          drawPixel(11, 9, skinColor);
          currentSprite.push({ x: 11, y: 8, color: skinColor });
          currentSprite.push({ x: 11, y: 9, color: skinColor });
          break;
        case 'thief':
          // Cloak
          for (let y = 6; y < 14; y++) {
            for (let x = 4; x < 12; x++) {
              if (Math.random() > 0.4) {
                drawPixel(x, y, clothingColor);
                currentSprite.push({ x, y, color: clothingColor });
              }
            }
          }
          // Improved dual dagger design with random color details
          const daggerBladeColor = '#c0c0c0';
          const daggerHiltColor = randomChoice(['#ffd700', '#c0c0c0', '#8b4513']);
          const daggerDetailColor = randomChoice(colors.weaponDetails);

          // Left dagger
          // Blade
          for (let y = 11; y < 15; y++) {
            drawPixel(3, y, daggerBladeColor);
            currentSprite.push({ x: 3, y, color: daggerBladeColor });
          }

          // Edge highlight
          for (let y = 12; y < 15; y++) {
            drawPixel(2, y, daggerDetailColor);
            currentSprite.push({ x: 2, y, color: daggerDetailColor });
          }

          // Hilt
          drawPixel(2, 11, daggerHiltColor);
          drawPixel(4, 11, daggerHiltColor);
          drawPixel(3, 10, daggerHiltColor);
          drawPixel(3, 9, daggerDetailColor);
          currentSprite.push({ x: 2, y: 11, color: daggerHiltColor });
          currentSprite.push({ x: 4, y: 11, color: daggerHiltColor });
          currentSprite.push({ x: 3, y: 10, color: daggerHiltColor });
          currentSprite.push({ x: 3, y: 9, color: daggerDetailColor });

          // Right dagger
          // Blade
          for (let y = 11; y < 15; y++) {
            drawPixel(12, y, daggerBladeColor);
            currentSprite.push({ x: 12, y, color: daggerBladeColor });
          }

          // Edge highlight
          for (let y = 12; y < 15; y++) {
            drawPixel(13, y, daggerDetailColor);
            currentSprite.push({ x: 13, y, color: daggerDetailColor });
          }

          // Hilt
          drawPixel(11, 11, daggerHiltColor);
          drawPixel(13, 11, daggerHiltColor);
          drawPixel(12, 10, daggerHiltColor);
          drawPixel(12, 9, daggerDetailColor);
          currentSprite.push({ x: 11, y: 11, color: daggerHiltColor });
          currentSprite.push({ x: 13, y: 11, color: daggerHiltColor });
          currentSprite.push({ x: 12, y: 10, color: daggerHiltColor });
          currentSprite.push({ x: 12, y: 9, color: daggerDetailColor });

          // Hands holding daggers
          drawPixel(4, 12, skinColor);
          drawPixel(4, 13, skinColor);
          drawPixel(11, 12, skinColor);
          drawPixel(11, 13, skinColor);
          currentSprite.push({ x: 4, y: 12, color: skinColor });
          currentSprite.push({ x: 4, y: 13, color: skinColor });
          currentSprite.push({ x: 11, y: 12, color: skinColor });
          currentSprite.push({ x: 11, y: 13, color: skinColor });
          break;
      }

      // Generate shoes
      const shoeColor = randomChoice(colors.shoes);
      drawPixel(5, 14, shoeColor);
      drawPixel(6, 14, shoeColor);
      drawPixel(9, 14, shoeColor);
      drawPixel(10, 14, shoeColor);
      drawPixel(5, 15, shoeColor);
      drawPixel(6, 15, shoeColor);
      drawPixel(9, 15, shoeColor);
      drawPixel(10, 15, shoeColor);

      currentSprite.push({ x: 5, y: 14, color: shoeColor });
      currentSprite.push({ x: 6, y: 14, color: shoeColor });
      currentSprite.push({ x: 9, y: 14, color: shoeColor });
      currentSprite.push({ x: 10, y: 14, color: shoeColor });
      currentSprite.push({ x: 5, y: 15, color: shoeColor });
      currentSprite.push({ x: 6, y: 15, color: shoeColor });
      currentSprite.push({ x: 9, y: 15, color: shoeColor });
      currentSprite.push({ x: 10, y: 15, color: shoeColor });

      // Generate eyes
      // drawPixel(7, 3, '#000000');
      // drawPixel(8, 3, '#000000');
      // currentSprite.push({ x: 7, y: 3, color: '#000000' });
      // currentSprite.push({ x: 8, y: 3, color: '#000000' });

      // Generate mouth
      // drawPixel(7, 4, '#000000');
      // drawPixel(8, 4, '#000000');
      // currentSprite.push({ x: 7, y: 4, color: '#000000' });
      // currentSprite.push({ x: 8, y: 4, color: '#000000' });

      if (animationFrameId) {
        cancelAnimationFrame(animationFrameId);
        animationFrameId = null;
      }


      const animateButton = document.getElementById('animateButton');
      if (currentProfession === 'mage') {
        animateButton.disabled = false;
      } else {
        animateButton.disabled = true;
      }
    }

    function downloadSprite() {
      const dataURL = canvas.toDataURL('image/png');
      const link = document.createElement('a');
      link.href = dataURL;
      link.download = 'fantasy_sprite.png';
      link.click();
    }

    function isSimilarColor(color1, color2) {
      const rgb1 = hexToRgb(color1);
      const rgb2 = hexToRgb(color2);
      const threshold = 50; // Adjust this value to change sensitivity

      const diff = Math.sqrt(
        Math.pow(rgb1.r - rgb2.r, 2) +
        Math.pow(rgb1.g - rgb2.g, 2) +
        Math.pow(rgb1.b - rgb2.b, 2)
      );

      return diff < threshold;
    }

    function hexToRgb(hex) {
      const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
      } : null;
    }



    function animateSprite() {
      // Limpiar el canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Dibujar el sprite en la nueva posición X e Y
      drawSprite(spriteXPosition, spriteYPosition);

      // Actualizar la posición Y para el siguiente frame
      spriteYPosition += directionY;

      // Mover en la dirección X hacia la posición objetivo
      if (directionX !== 0) {
        spriteXPosition += directionX;
        if ((directionX > 0 && spriteXPosition >= targetXPosition) ||
          (directionX < 0 && spriteXPosition <= targetXPosition)) {
          // Cuando el sprite alcanza la posición objetivo, detener el movimiento en X
          directionX = 0;
        }
      }

      // Invertir la dirección en Y si el sprite alcanza los límites del canvas
      if (spriteYPosition > canvas.height - spriteSize * pixelSize) {
        directionY = -1;
      }

      // Detener la animación cuando el sprite regrese a la posición inicial en Y
      if (spriteYPosition <= -1 && directionY === -1) {
        cancelAnimationFrame(animationFrameId);
        animationFrameId = null;

        spriteYPosition = 0;  // Resetear la posición del sprite para la próxima animación
        spriteXPosition = 0;  // Resetear la posición en X también
        directionY = 1;  // Resetear la dirección para la próxima animación

      } else {
        // Añadir efecto de daño

        // Solicitar el siguiente frame de la animación
        animationFrameId = requestAnimationFrame(animateSprite);
      }
    }

    function drawSprite(xOffset, yOffset) {
      currentSprite.forEach(pixel => {
        drawPixel(pixel.x + xOffset, pixel.y + yOffset, pixel.color);
      });


    }

    function startAnimationDef() {

      if (currentProfession === 'mage' && !isAnimating) {

        console.log("defense");
        isAnimating = true;  // Marcar que la animación está en curso
        spriteYPosition = 0;  // Resetear la posición en Y del sprite al iniciar la animación
        spriteXPosition = 0;  // Resetear la posición en X del sprite al iniciar la animación
        directionY = 1;  // Resetear la dirección en Y
        directionX = -1;  // Mover hacia atrás
        targetXPosition = -10;  // Ajustar según cuánto quieras mover hacia atrás
        animateSprite();  // Iniciar la animación
        flashRedOverlay()
        endAnimation()

      }
    }

    function startAnimationAtk() {
      if (currentProfession === 'mage' && !isAnimating) {
        console.log("atk");
        isAnimating = true;  // Marcar que la animación está en curso
        spriteYPosition = 0;  // Resetear la posición en Y del sprite al iniciar la animación
        spriteXPosition = 0;  // Resetear la posición en X del sprite al iniciar la animación
        directionY = 1;  // Resetear la dirección en Y
        directionX = 1;  // Mover hacia adelante
        targetXPosition = 10;  // Ajustar según cuánto quieras mover hacia adelante
        animateSprite();  // Iniciar la animación
        endAnimation()

      }
    }

    function endAnimation() {

      setTimeout(() => {
        directionY = 0;  // Resetear la dirección en Y
        directionX = 0;  // Mover hacia atrás
        targetXPosition = 0;  // Ajustar según cuánto quieras mover hacia atrás
        animateSprite();  // Iniciar la animación
        isAnimating = false;  // Marcar que la animación ha terminado
      }, 50)
    }
    function flashRedOverlay() {

      // Guardar el estado actual del contexto
      ctx.save();

      // Establecer el color rojo semitransparente
      ctx.fillStyle = 'rgba(255, 0, 0, 0.2)'; // 50% de transparencia
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Si isAnimating es verdadero, continúa ejecutando el overlay
      if (isAnimating) {
        requestAnimationFrame(flashRedOverlay); // Volver a ejecutar en el siguiente frame
      } else {
        // Restaurar el estado del contexto solo cuando la animación termine
        ctx.restore();
      }
    }

    // Iniciar la generación del sprite
    generateSprite();

  </script>
</body>

</html>